<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
	layout:decorator="fragments/template">
<head lang="it">
</head>
<body>
	<div layout:fragment="content" id="main-container" th:fragment="content" th:with="counter=${personaWrapper.idOffset - 1}">
		<div class="row">
			<div class="col-xs-12">
				<div class="x_panel">
					<div class="x_title">
						<h2 th:text="#{label.dati_del} + ' ' + ${personaWrapper.persona.ruolo.nome}">Dati del persona.ruolo</h2>
						<div class="pull-right buttons-header">
							<button id="cerca-persona-btn" class="btn btn-primary pull-right" th:text="#{label.lookup}" data-toggle="modal" data-target=".modal-lookup">lookup</button>
							<a class="btn btn-primary pull-right" th:text="#{label.nuovo}" th:href="@{|/accreditamento/${personaWrapper.accreditamentoId}/provider/${personaWrapper.providerId}/persona/setAnagrafica?ruolo=${personaWrapper.persona.ruolo}|}"></a>
							<a class="btn btn-primary pull-right" th:text="#{label.annulla}" th:href="@{|/accreditamento/${personaWrapper.accreditamentoId}|}"></a>
						</div>
						<div class="clearfix"></div>
					</div>
					
					<!-- finestra modale di lookup delle anagrafiche -->
					<div id="persona-modal" class="modal fade modal-lookup" tabindex="-1" role="dialog" aria-hidden="true">
						<div class="modal-dialog modal-lg">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span>
									</button>
									<h4 class="modal-title" id="myModalLabel" th:text="#{label.cerca_persona}">Cerca anagrafica</h4>
								</div>
								<div class="modal-body">
									<table id="tabella-modale" class="datatable-responsive-search table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
										<thead>
											<tr>
												<th th:text="#{label.codice_fiscale}">Codice fiscale</th>
												<th th:text="#{label.nome}">Nome</th>
												<th th:text="#{label.cognome}">Cognome</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											<!-- popolata con una request ajax -->
										</tbody>
									</table>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-primary" data-dismiss="modal" th:text="#{label.chiudi}">Chiudi</button>
								</div>
							</div>
						</div>
					</div>
					
					<!-- panel con il form -->
					<div class="x_content">
						<form id="formPersona" class="form-horizontal form-label-left" th:action="@{|/accreditamento/${personaWrapper.accreditamentoId}/provider/${personaWrapper.providerId}/persona/save|}"
								method="post" enctype="multipart/form-data" novalidate="novalidate">
								
							<input type="hidden" name="editId" th:value="${personaWrapper.persona.id}" />
							<input type="hidden" name="editId_Anagrafica" th:value="${personaWrapper.persona.anagrafica.id}" /> 
							<input type="hidden" th:field="${personaWrapper.accreditamentoId}" /> 
							<input type="hidden" th:field="${personaWrapper.providerId}" /> 
							<input type="hidden" th:field="${personaWrapper.ruolo}" /> 
							<input type="hidden" th:field="${personaWrapper.idEditabili}" />
							<input type="hidden" th:field="${personaWrapper.idOffset}" />
							
							<!--	
							<input type="hidden" name="editIdFileAtto" th:value="${personaWrapper.nomina.id}" />
							<input type="hidden" name="editIdFileCV" th:value="${personaWrapper.curriculumVitae.id}" />
							<input type="hidden" name="editIdFileDelega" th:value="${personaWrapper.delega.id}" />
							 -->
							 
							<!-- cognome -->
							<div class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.cognome')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">1</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="cognome_persona"><span th:text="#{label.cognome}">Cognome</span> <span	class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="cognome_persona"	name="cognome_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="text" th:field="${personaWrapper.persona.anagrafica.cognome}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="cognome_persona_disabled"	
											class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.cognome}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.cognome')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.cognome}"></div>
							</div>
							
							<!-- nome -->
							<div class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.nome')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">2</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="cognome_persona"><span th:text="#{label.nome}">Nome</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="nome_persona" name="nome_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="text" th:field="${personaWrapper.persona.anagrafica.nome}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="nome_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											 th:text="${personaWrapper.persona.anagrafica.nome}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.nome')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.nome}"></div>
							</div>
							
							<!-- codice fiscale -->
							<div class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.codiceFiscale')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">3</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="codiceFiscale_persona"><span th:text="#{label.codice_fiscale}">Codice Fiscale</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">									
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="codiceFiscale_persona" name="codiceFiscale_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="text" th:field="${personaWrapper.persona.anagrafica.codiceFiscale}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="codiceFiscale_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.codiceFiscale}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.codiceFiscale')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.codiceFiscale}"></div>
							</div>
							
							<!-- checkbox flag straniero -->
							<div th:if="${personaWrapper.persona.coordinatoreComitatoScientifico} or
										${personaWrapper.persona.componenteComitatoScientifico}"
								class="item form-group">
								<label class="control-label col-xs-1"></label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="isStraniero_persona"><span th:text="#{label.cf_straniero}">Ha un codice fiscale non italiano</span> <span class="required">*</span></label>
								<div class="col-md-4 col-sm-4 col-xs-12">
									<input id="isStraniero_persona" name="isStraniero_persona" 
										class="form-control col-md-7 col-xs-12"
										type="checkbox" th:checked="${personaWrapper.persona.anagrafica.isStraniero}" />
								</div>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.codiceFiscale')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.codiceFiscale}"></div>
							</div>
							
							<!-- telefono -->
							<div class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.telefono')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">4</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="telefono_persona"><span th:text="#{label.telefono}">Telefono</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">																	
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="telefono_persona" name="telefono_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="tel" th:field="${personaWrapper.persona.anagrafica.telefono}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="telefono_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.telefono}"></label>
									</div>
								</th:block>								
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.telefono')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.telefono}"></div>
							</div>
							
							<!-- cellulare -->
							<div th:unless="${personaWrapper.persona.responsabileSegreteria} or 
											${personaWrapper.persona.responsabileFormazione} or
											${personaWrapper.persona.responsabileSistemaInformatico} or
											${personaWrapper.persona.responsabileQualita}" 
								class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.cellulare')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">5</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="cellulare_persona"><span th:text="#{label.cellulare}">Cellulare</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">																									
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="cellulare_persona" name="cellulare_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="tel" th:field="${personaWrapper.persona.anagrafica.cellulare}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="cellulare_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.cellulare}"></label>
									</div>
								</th:block>					
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.cellulare')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.cellulare}"></div>
							</div>
							
							<!-- email -->
							<div class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.email')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">6</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="email_persona"><span th:text="#{label.email}">Email</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">									
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="email_persona" name="email_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="email" th:field="${personaWrapper.persona.anagrafica.email}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="email_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.email}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.email')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.email}"></div>
							</div>
							
							<!-- posta elettronica certificata (PEC) -->
							<div th:if="${personaWrapper.persona.legaleRappresentante} or
										${personaWrapper.persona.delegatoLegaleRappresentante}"
								class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.anagrafica.pec')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">7</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="pec_persona"><span th:text="#{label.posta_elettronica_certificata}">Posta elettronica certificata (PEC)</span> <span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<input id="pec_persona" name="pec_persona" 
											required="required"	class="form-control col-md-7 col-xs-12"
											type="email" th:field="${personaWrapper.persona.anagrafica.pec}" />
									</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="pec_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.anagrafica.pec}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.anagrafica.pec')}" class="alert" th:errors="${personaWrapper.persona.anagrafica.pec}"></div>
							</div>
							
							<!-- professione -->	
							<div th:if="${personaWrapper.persona.coordinatoreComitatoScientifico} or
										${personaWrapper.persona.componenteComitatoScientifico} or
										${personaWrapper.persona.responsabileSistemaInformatico} or
										${personaWrapper.persona.responsabileQualita}"
								class="item form-group" th:classappend="${#fields.hasErrors('personaWrapper.persona.professione')} ? 'bad'">
								<label class="control-label col-xs-1" th:text="${++counter}">8</label>
								<label class="control-label col-md-3 col-sm-3 col-xs-11"
									for="professione_persona"><span th:text="#{label.professione}">Professione</span><span class="required">*</span></label>
								<th:block th:if="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<select id="professione_persona" class="form-control required" th:field="${personaWrapper.persona.professione}">
			                          			<option value="" th:text="#{label.seleziona}">label.seleziona</option>
			                          			<option th:each="professione : ${professioneList}" th:value="${professione.id}" th:text="${professione.nome}">Choose option</option>
			                        	</select>
								  	</div>
								</th:block>
								<th:block th:unless="${#lists.contains(personaWrapper.idEditabili, counter)}">
									<div class="col-md-4 col-sm-4 col-xs-12">
										<label id="professione_persona_disabled" class="form-control form-disabled-text left-align col-md-7 col-xs-12"
											th:text="${personaWrapper.persona.professione}"></label>
									</div>
								</th:block>
								<div th:if="${#fields.hasErrors('personaWrapper.persona.professione')}" class="alert" th:errors="${personaWrapper.persona.professione}"></div>
							</div>
							
							<!-- allegato 1 (atto di nomina) -->
							<th:block th:unless="${personaWrapper.persona.delegatoLegaleRappresentante}" th:include="fragments/allegati :: allegati(personaWrapper, attoNomina, ${++counter}, null)" ></th:block>
							
							<!-- allegato 2 (curriculum vitae) -->
							<th:block th:unless="${personaWrapper.persona.legaleRappresentante}" th:include="fragments/allegati :: allegati(personaWrapper, cv, ${++counter}, null)"></th:block>
							
							<!-- allegato 3 (delega) -->
							<th:block th:if="${personaWrapper.persona.delegatoLegaleRappresentante}" th:include="fragments/allegati :: allegati(personaWrapper, delega, ${++counter}, null)"></th:block>
							
							<!-- Registra Persona -->
							<div class="item form-group text-right">
								<input class="btn btn-primary right" name="save_persona" type="submit" th:value="#{label.salva}"/>
							</div>							
						</form>
					</div>
				</div>
			</div>
			<script th:inline="javascript">
			$("#cerca-persona-btn").one("click", function(){
				console.log("sto facendo l'ajax request!");
				$.get( "/provider/" + [[${personaWrapper.providerId}]] + "/anagraficaList", function(data){
					for(item in data){
						console.log(item);
						var obj = data[item];
						console.log(obj);
						var row = '	<tr role="row">																										\
										<td>'+ obj.codiceFiscale +'</td>																		\
										<td>'+ obj.nome + '</td>																				\
										<td>'+ obj.cognome + '</td>																				\
										<td><button class="btn btn-primary" th:text="#{label.seleziona}" onclick="loadPersona('+ obj.id +')"></button></td>	\
									</tr>'
						$("#tabella-modale > tbody").append(row);
					}
				});      
			});
			
			function loadPersona(id){
				//var url = "/accreditamento/" + [[${personaWrapper.accreditamentoId}]] + "/provider/" + [[${personaWrapper.providerId}]] + "/anagrafica/" + id +"/copia";
				var RUOLO = [[${personaWrapper.persona.ruolo}]];
				var url = "/accreditamento/" + [[${personaWrapper.accreditamentoId}]] + "/provider/" + [[${personaWrapper.providerId}]] + "/persona/setAnagrafica?ruolo=" + RUOLO.$name + "&anagraficaId;=" + id;
				$("#main-container").load(url);
			}
			</script>
		</div>
	</div>
</body>
</html>